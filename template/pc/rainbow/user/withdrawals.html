<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>申请提现</title>
        <link rel="shortcut  icon" type="image/x-icon" href="{$tpshop_config.shop_info_store_ico|default='/public/static/images/logo/storeico_default.png'}" media="screen"/>
		<link rel="stylesheet" type="text/css" href="__STATIC__/css/tpshop.css" />
		<link rel="stylesheet" type="text/css" href="__STATIC__/css/myaccount.css" />
		<link rel="shortcut  icon" type="image/x-icon" href="{$tpshop_config.shop_info_store_ico|default='/public/static/images/logo/storeico_default.png'}" media="screen"  />
		<script src="__STATIC__/js/jquery-1.11.3.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="__PUBLIC__/js/md5.min.js"></script>
		<style>
			.clear {
				clear: both;
			}
		</style>
	</head>
	<body class="bg-f5">
		<include file="user/header"/>
		<div class="home-index-middle">
			<div class="w1224">
				<div class="g-crumbs">
			       	<a href="/">我的商城</a>
			       	<i class="litt-xyb"></i>
			       	<span>账户余额</span>
			    </div>
			    <div class="home-main">
					<include file="user/menu"/>
			    	<div class="ri-menu fr">
						<div class="menumain p">
							<div class="goodpiece">
								<h1>提现申请</h1>
								<a href="{:U('Home/Article/detail',['article_id'=>101])}"><span class="co_blue">账户余额说明</span></a>
								<input type="hidden" id="openid" value="{$user.openid}">
							</div>
							<div class="personerinfro tixbox">
								<form action="" method="post" id="distribut_form">
									<ul class="hend_jz">
										<li class="infor_wi_le"><a href="javascript:void(0);"><i class="star">*</i>提现金额：</a></li>
										<li class="infor_img">
											<div class="duleyuan">
												<input type="text" name="money" id="money" onpaste="this.value=this.value.replace(/[^\d.]/g,'')" onKeyUp="this.value=this.value.replace(/[^\d.]/g,'')" onblur="get_service();" />
												<span>元</span>
											</div>
											<span class="keyj">(提现金额限制{$tpshop_config.cash_min_cash} - {$tpshop_config.cash_max_cash?:'x'} 元，当前账户金额：<em>{$user.user_money}</em>元)</span>
											<p class="adviceql clear">手续费：<span id="taxfee">0</span>&nbsp;元</p>
										</li>
									</ul>
									<ul class="name_jz">
										<li class="infor_wi_le"><a href="javascript:void(0);"><i class="star">*</i>提现账户类型：</a></li>
										<li class="paydegs">
											<span><i class="chek"></i><label>银行卡</label></span>
											<span><i></i><label>支付宝</label></span>
											<span><i></i><label>微信</label></span>
										</li>
									</ul>
									<ul class="name_jz">
										<li class="infor_wi_le"><a href="javascript:void(0);"><i class="star">*</i>收款银行：</a></li>
										<li>
											<a href="javascript:void(0);">
											<input class="name_zjxs" type="text" name="bank_name" id="bank_name" value="{$user.bank_name}" placeholder="如:支付宝,农业银行,工商银行等..." /></a>
											<p class="adviceql">建议填写4大银行（中国银行、中国建设银行、中国工商银行和中国农业银行）请填写详细的开户银行分行名称，虚拟账户如支付宝、微信填写”支付宝“、”微信“即可。</p>
										</li>
									</ul>
									<ul class="name_jz">
										<li class="infor_wi_le"><a href="javascript:void(0);"><i class="star">*</i>收款账号：</a></li>
										<li>
											<a href="javascript:void(0);"><input class="name_zjxs" type="text" name="bank_card" id="bank_card" value="{$user.bank_card}" /></a>
											<p class="adviceql">银行账号或虚拟账号（支付宝、微信等账号），微信提现时只需会员账号绑定微信账号即可</p>
										</li>
									</ul>
									<ul class="name_jz">
										<li class="infor_wi_le"><a href="javascript:void(0);"><i class="star">*</i>开户人姓名：</a></li>
										<li>
											<a href="javascript:void(0);"><input class="name_zjxs wisd" type="text" name="realname" id="realname" value="{$user.realname}" /></a>
											<p class="adviceql">收款账号的开户人姓名</p>
										</li>
									</ul>
									<ul class="name_jz">
										<li class="infor_wi_le"><a href="javascript:void(0);"><i class="star">*</i>支付密码：</a></li>

										<li>
											<a href="javascript:void(0);"><input class="name_zjxs wisd" type="password" name="paypwd" id="paypwd" value="" /></a>
											<empty name="$user.paypwd">
												<p class="haiew">还未设置支付密码</p>
												<a class="ha-re" style="cursor:pointer" href="{:U('User/paypwd')}">马上设置</a> 
											</empty>
										</li>

									</ul>
									<ul class="name_jz" <if condition="$tpshop_config['cash_cash_open'] neq '1'">style="display: none;"<else/>style="background: #f5f5f5;"</if>>
										<li class="infor_wi_le"><a href="javascript:void(0);">温馨提示：</a></li>
										<li>
											<p>1.提现金额须大于 {$tpshop_config.cash_min_cash}{$tpshop_config.cash_max_cash ?= ' 元，小于 ' . $tpshop_config.cash_max_cash} 元。</p>
											<p>2.手续费在到账金额中扣除。</p>
											<p>3.提现收取 {$tpshop_config.cash_service_ratio}% 的手续费。</p>
											<if condition="$tpshop_config['cash_max_service_money'] eq '0' AND $tpshop_config['cash_min_service_money'] eq '0'">
												<p>4.提现审核一般3 - 5个工作日到账。</p>
											<else/>
												<p>4.每笔{$tpshop_config.cash_min_service_money > 0 ?='最低 '.$tpshop_config.cash_min_service_money.' 元'}{$tpshop_config.cash_max_service_money > 0 ?='最高 '.$tpshop_config.cash_max_service_money.' 元'}手续费。</p>
												<p>5.提现审核一般 3 - 5 个工作日到账。</p>
											</if>
										</li>
									</ul>
									<ul class="hobby_jz">
										<li class="infor_wi_le"><a href="javascript:void(0);"></a></li>
										<li class="infor_wi_ri">
											<div class="save_s">
												<input class="save" type="button" onclick="checkSubmit()" value="确认提现" />
												<input class="save closoff" type="reset" onclick="location.href='{:U('User/recharge')}'" value="取消并返回" />
											</div>
										</li>
									</ul>
								</form>
							</div>
						</div>
			    	</div>
			    </div>
			</div>
		</div>
		<!--footer-s-->
		<include file="user/footer" />
		<!--footer-e-->
		<script type="text/javascript">
			var service_ratio='{$tpshop_config.cash_service_ratio}';
			var min_cash='{$tpshop_config.cash_min_cash}';
			var max_cash='{$tpshop_config.cash_max_cash}';
			var min_service_money='{$tpshop_config.cash_min_service_money}';
			var max_service_money='{$tpshop_config.cash_max_service_money}';
			//手续费计算及显示
			function get_service(){
				var m=$('input[name=money]').val();
				if (m) {
					if(max_cash > 0 && parseFloat(m)>parseFloat(max_cash)){
						layer.open({content:'单次提现额不得大于'+max_cash,icon:2,time:2000});
						$('input[name=money]').val('');
						return false;
					}
					if(parseFloat(m)<parseFloat(min_cash)){
						layer.open({content:'单次提现额不得小于'+min_cash,icon:2,time:2000});
						$('input[name=money]').val('');
						return false;
					}
					var r = get_taxfee(m);	
				} else {
					var r = 0;	
				}
				$('#taxfee').html(r);
			}

			// 获取手续费
			function get_taxfee(m) {
				if (service_ratio > 0) {
					var r=(m*service_ratio)/100;
					r=parseFloat(r.toFixed(2));
					if (max_service_money == 0) {
						return r;
					}
					if(r<parseFloat(min_service_money)){
						r=min_service_money;
					}
					if(r>parseFloat(max_service_money)){
						r=max_service_money;
					}
				} else {
					var r = 0;
				}
				return r;
			}
		
			$(function(){
				$('.paydegs span').click(function(){
					var bankstr = $(this).find('label').html();
					if(bankstr =='微信'){
						if($('#openid').val() == ''){
							layer.alert('请在用户中心账号绑定里先扫码绑定微信账号');
							return false;
						}
					}
					$('.paydegs span').find('i').removeClass('chek');
					if(bankstr != '银行卡'){
						$('#bank_name').val($(this).find('label').html());
						$('#bank_name').attr('readonly','readonly');
						if(bankstr == '微信'){
							$('#bank_card').val($('#openid').val());
							$('#bank_card').attr('readonly','readonly');
						}else{
							$('#bank_card').val('');
							$('#bank_card').removeAttr('readonly');
						}
					}else{
						$('#bank_name').val('');
						$('#bank_name').removeAttr('readonly');
					}
					$(this).find('i').addClass('chek');
				})
                $(document).on('blur', '#paypwd', function () {
                    var auth_code = '{$Think.config.AUTH_CODE}';
                    var paypwd = md5(auth_code + $.trim($('#paypwd').val()));
                    $('input[name="paypwd"]').val(paypwd);
                })
			})
			// 表单验证提交
			function checkSubmit(){
				var money = $.trim($('#money').val());
				var bank_name = $.trim($('#bank_name').val());
				var bank_card = $.trim($('#bank_card').val());
				var realname = $.trim($('#realname').val());
				var paypwd = $.trim($('#paypwd').val());
				
				if(money == '')
				{
					layer.alert('提现金额必填', {icon: 2});
					return false;
				}
				if(money < {$tpshop_config.cash_min_cash})
				{
					layer.alert("每次最低提现额度{$tpshop_config['cash_min_cash']}");
					return false;
				}
				if({$tpshop_config.cash_max_cash} > 0 && money >{$tpshop_config.cash_max_cash})
				{
					layer.alert("每次最高提现额度{$tpshop_config['cash_max_cash']}");
					return false;
				}
				if(money > {$user['user_money']})
				{
					layer.alert("本次最高提现额度不得超过账户余额,你的账户余额{$user['user_money']}");
					return false;
				}
						
				if(bank_name == '')
				{
					layer.alert('银行名称必填', {icon: 2});
					return false;
				}
				if(bank_card == '')
				{
					layer.alert('收款账号必填', {icon: 2});
					return false;
				}
				if(realname == '')
				{
					layer.alert('开户名必填', {icon: 2});
					return false;
				}
				if(paypwd == '')
				{
					layer.alert('支付密码必填', {icon: 2});
					return false;
				}
				$('#distribut_form').submit();
			}
		</script>
	</body>
</html>