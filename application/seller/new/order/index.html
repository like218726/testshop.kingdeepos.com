<include file="public/head"/>
<style>
  .w150{
    margin-right: 35px;
  }
  .w378{
    display: inline-block !important;
  }
  .di-in{
    display: inline-block !important;
  }
  .w160{
    width: 160px !important;
  }
  .nscs-table-handle{
    border-right: 1px solid #dedede;
  }
</style>
<div class="ncsc-layout wrapper">
  <include file="public/left"/>
  <div id="layoutRight" class="ncsc-layout-right">
    <div class="ncsc-path"><i class="icon-desktop"></i>商家管理中心<i class="icon-angle-right"></i>订单物流<i class="icon-angle-right"></i>订单列表</div>
    <div class="main-content" id="mainContent">
      
<div class="tabmenu">
  <ul id="tab" class="tab pngFix">
  	<li class="<if condition='is_null($Request.param.order_status)'>active<else/>normal</if>" data-val=""><a  href="#">所有订单</a></li>
  	<li class="<if condition='$Request.param.order_status heq 0'>active<else/>normal</if>" data-val="0"><a  href="#">待确认</a></li>
  	<li class="<if condition='$Request.param.order_status eq 1'>active<else/>normal</if>" data-val="1"><a  href="#">已确认</a></li>
  	<li class="<if condition='$Request.param.order_status eq 2'>active<else/>normal</if>" data-val="2"><a  href="#">已收货</a></li>
  	<li class="<if condition='$Request.param.order_status eq 3'>active<else/>normal</if>" data-val="3"><a  href="#">已取消</a></li>
  	<li class="<if condition='$Request.param.order_status eq 4'>active<else/>normal</if>" data-val="4"><a  href="#">已完成</a></li>
  	<li class="<if condition='$Request.param.order_status eq 5'>active<else/>normal</if>" data-val="5"><a  href="#">已关闭</a></li>
  </ul>
  </div>
<form method="get" action="{:U('order/export_order')}" id="search-form2">
	<input type="hidden" name="seller_order_type" value="{$seller_order_type|default=0}">
    <input type="hidden" name="order_by" value="order_id"/>
    <input type="hidden" name="sort" value="desc"/>
    <input type="hidden" name="order_status" id="order_status" value="{$Request.param.order_status}"/>
    <input type="hidden" value="{$_GET['order_statis_id']|default=0}" name="order_statis_id" id="order_statis_id"/>
  <table class="search-form">
    <tr>
      <th>收货人{$shipping_status_chose}</th>
      <td class="w150"><input type="text" class="text w150" name="consignee" placeholder="收货人" value=""/></td>
      <th>订单编号{$pay_status_chose}</th>
      <td class="w150"><input type="text" class="text w150" name="order_sn" placeholder="订单编号" value=""/></td>
      <th>下单时间</th>
      <td class="w378">
	      <input type="text" class="text w150" name="start_time" id="start_time" placeholder="开始时间" value="{$start_time}"/>
	      <input type="text" class="text w150" name="end_time" id="end_time" placeholder="结束时间" value="{$end_time
      }"/>
	   </td>
     </tr>
     <tr> 
      <th>支付状态</th>
      <td class="w160">
          <select id="pay" name="pay_status" class="w150 w160">
              <option value="">支付状态</option>
              <option value="0" <if condition="$Request.param.pay_status heq '0'">selected='selected'</if>>未支付</option>
              <option value="1" <if condition="$Request.param.pay_status eq 1">selected='selected'</if>>已支付</option>
          </select>
      </td>
      <th>发货状态</th>
      <td class="w160">
      		<select id="shipping" name="shipping_status" class="w150 w160">
          		  <option value="">发货状态</option>
                <option value="0" <if condition="$Request.param.shipping_status heq '0'">selected='selected'</if>>未发货</option>
               	<option value="1" <if condition="$Request.param.shipping_status eq 1">selected='selected'</if>>已发货</option>
               	<option value="2" <if condition="$Request.param.shipping_status eq 2">selected='selected'</if>>部分发货</option>
          </select>
		  </td>
      <th>支付方式</th>
      <td><select name="pay_code" class="w150 w160 di-in">
          		  <option value="">支付方式</option>
                <option value="alipay">支付宝支付</option>
                <option value="weixin">微信支付</option>
                <!--<option value="cod">货到付款</option>-->
          </select>
             <label class="submit-border"><input class="submit" value="搜索" onclick="ajax_get_table('search-form2',1)" type="button"></label>
          <input type="hidden" name="order_ids" value="">
         <a id="S2" href="javascript:exportReport()" class="ncbtn-mini"  title="批量导出" style="background-color:#48CFAE;height: 22px;line-height: 22px;margin-left: 20px;">批量导出</a>
      </td>
    </tr>
    <!--tr>
      <td style="width:160px"><a id="S1" href="javascript:void(0)" class="ncbtn-mini" title="批量打印配货单"><span><i class="icon-print"></i>批量打印配货单</a></span></td>
    </tr-->
  </table>
</form>
<div id="ajax_return">
	 
</div>
<script>
$(document).ready(function(){	
	   
 	$('#start_time').layDate();
 	$('#end_time').layDate();
 	 

 	ajax_get_table('search-form2',1);
 	
 	$("#tab > li").each(function(){
		$(this).click(function(){
			tabSelect(this);
		});
	});
});
    // 起始位置日历控件
	laydate.render('molv');//选择肤色
	laydate.render({
	  elem: '#start_time',
    theme:'molv',
	  format: 'yyyy-MM-dd', // 分隔符可以任意定义，该例子表示只显示年月
	  calendar: true, //显示节日
	  istime: false,
	  choose: function(datas){ //选择日期完毕的回调
		 compare_time($('#start_time').val(),$('#end_time').val());
	  }
	});
	 
	 // 结束位置日历控件
	laydate.render({
	  elem: '#end_time',
    theme:'molv',
	  format: 'yyyy-MM-dd', // 分隔符可以任意定义，该例子表示只显示年月
	  calendar: true, //显示节日
	  istime: false,
	  choose: function(datas){ //选择日期完毕的回调
		   compare_time($('#start_time').val(),$('#end_time').val());
	  }
	});


function tabSelect(obj){
	var currHasClass = $(obj).hasClass('active');
	if(currHasClass)return;
	
	$("#tab > li").each(function(){
		$(this).removeClass('active');
	});
	
	$(obj).addClass('active');
	var orderStatus = $(obj).attr("data-val");
	$("#order_status").val(orderStatus);
	ajax_get_table('search-form2',1);
}

function ajax_get_table(tab,page){
    var pay = $('#pay').val();
    var shipping = $('#shipping').val();
    var order_statis_id = $('#order_statis_id').val();
	cur_page = page; //当前页面 保存为全局变量
	var ajaxUrl = "/index.php/Seller/order/ajaxindex/p/"+page;
	if(order_statis_id>0){
		ajaxUrl = "/index.php/Seller/order/ajaxindex/p/"+page+"order_statis_id/"+order_statis_id+'/pay/'+pay+'/shipping/'+shipping;
	}
    $.ajax({
        type : "POST",
        url: ajaxUrl,
        data : $('#'+tab).serialize(),// 你的formid
        success: function(data){
            $("#ajax_return").html('');
            $("#ajax_return").append(data);
        }
    });
}


var url='{:U("Order/order_print")}';
$("#S1").click(function(){ 
  var ids='';
  $("input[type='checkbox']:checkbox:checked").each(function(){ 
    ids+=$(this).val()+',';
  }) 
  url+='/ids/'+ids+'/template/picking';
  window.open(url); 
})


function exportReport(){
    var selected_ids = [];
    $('.checkbox').each(function(i){
        if($(this).context.checked){
            selected_ids.push($(this).val());
        }
    });
    if(selected_ids.length >0){
        $('input[name="order_ids"]').val(selected_ids.join(','));
    }else{
        $('input[name="order_ids"]').val('');
    }
    // console.log($('#search-form').serialize())
    // window.location.href='/index.php/seller/Order/export_order?'+$('#search-form').serialize();
    $('#search-form2').submit();
}
</script>    
</div>
  </div>
</div>
<include file="public/foot"/>
</body>
</html>
